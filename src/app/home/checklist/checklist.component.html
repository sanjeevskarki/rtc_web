<div id="container"></div>
<div  id="modalTarget" #targetModal >
    <div class="checklist-div">
        <span class="checklist-label">{{releaseName}} &nbsp;-&nbsp;{{milestone}}&nbsp;-&nbsp;{{workWeek}}</span>   
    </div>
    <br>
    <ejs-grid #grid [dataSource]='viewReleaseChecklist'  [allowTextWrap]="true" [allowSelection]='true' [allowSorting]='true' [allowGrouping]="true" [groupSettings]="groupOptions"
                    [pageSettings]='initialPage' [gridLines]="lines" (queryCellInfo)='customiseCell($event)' >
        <e-columns>
            <e-column field='vector'  [filter]='filter' headerText='Vector' width=45 textAlign="left" isPrimaryKey='true'></e-column>
            <e-column field='detail'  [filter]='filter' headerText='Detail' width=50 textAlign="left" isPrimaryKey='true'></e-column>
            <e-column field='owner' headerText='Owner' textAlign="left" width=40></e-column>
            <e-column field='Status' [filter]='filter' headerText='Status' textAlign="left" width='40'>
                 <ng-template #template let-data>                   
                   <div *ngIf="data.status === 'Done'" class="statustemp e-donecolor"> 
                        <ejs-splitbutton content={{data.status}} 
                        class="statustemp e-donecolor donecolor statustxt" [items]='items' (select)="changeStatus(data.id,$event)">{{data.status}}
                        </ejs-splitbutton>                                          
                    </div>
                    <div *ngIf="data.status === 'WIP'" class="statustemp e-wipcolor">  
                        <ejs-splitbutton content={{data.status}} 
                        class="statustemp e-wipcolor statustxt" [items]='items' (select)="changeStatus(data.id,$event)">{{data.status}}
                        </ejs-splitbutton>                                                  
                    </div>
                    <div *ngIf="data.status === 'Open'" class="statustemp e-opencolor"> 
                        <ejs-splitbutton content={{data.status}} 
                        class="statustemp e-opencolor statustxt" [items]='items' (select)="changeStatus(data.id,$event)">{{data.status}}
                        </ejs-splitbutton>                                                      
                    </div>
                    <div *ngIf="data.status === 'N/A'" class="statustemp e-nacolor">                                          
                        <ejs-splitbutton content={{data.status}} 
                        class="statustemp e-nacolor statustxt" [items]='items' (select)="changeStatus(data.id,$event)">{{data.status}}
                        </ejs-splitbutton>        
                    </div>  
                </ng-template>  
            </e-column> 
            <e-column field='detailedStatus' headerText='Detailed Status' textAlign='Left' width='50'></e-column>
            <e-column field='releaseCriteria' headerText='Release Criteria' textAlign='Left' width='50'></e-column>
            <e-column headerText='Evidence' textAlign='Center' width='50'>
                <ng-template #template let-evidence>
                    <button *ngIf="evidence.evidences.length > 0 ; else noEvidence" ejs-button cssClass="e-flat" [isPrimary]="true" (click)="onEvidenceClicked(evidence.id)">View Evidence...
                        <span class="e-icons e-evidence"></span>
                    </button>
                    <ng-template #noEvidence>
                        <span>No Evidence Found </span>
                        <button ejs-button cssClass="e-flat" [isPrimary]="true" (click)="onEvidenceClicked(evidence.id)">Add Evidence...
                            <span class="e-icons e-add"></span>
                        </button>
                      </ng-template>
                  </ng-template>     
            </e-column>
            <e-column headerText='Comments' textAlign='Left' width='90'>
                <ng-template #template let-data>
                    <div *ngIf="data.comments.length > 0" [innerHTML]="data.comments[0].message"></div>
                    <div *ngIf="data.comments.length > 0 ; else noComments" style="font-size: 11px;"> {{data.comments[0].date | date:'medium'}} 
                        <button ejs-button cssClass="e-flat" [isPrimary]="true" (click)="onCommentClicked(data.id)">View More...
                            <span class="e-icons e-search"></span>
                        </button>
                    </div>
                    <ng-template #noComments>
                        <span>No Comment Found </span><br>
                        <button ejs-button cssClass="e-flat" [isPrimary]="true" (click)="onCommentClicked(data.id)">Add Comments...
                            <span class="e-icons e-add"></span>
                        </button>
                      </ng-template>
                  </ng-template>
            </e-column>
        </e-columns>
    </ejs-grid>
    <br>
    <button ejs-button cssClass="e-info" [isPrimary]="true" style="float: right;" (click)="saveRelease()">Save Release</button>
</div>
<!--
    Dialog shows the comments list
-->
<ejs-dialog class='e-fixed' id="commentDialog" #commentDialog [header]='commentsHeader' [position]='position' [visible]='hidden' [isModal]='isModal'
[target]='target' [width]='width' [animationSettings]='animationSettings' [showCloseIcon]='showCloseIcon'>
    <ejs-listview #listview id='displayComments' style="height: 23rem;" [dataSource]='displayComments'
    [showHeader]='false' [cssClass]='cssClass'>
        <ng-template #template let-dataSource="">
            <div>
                <div style="float: right;margin-right: 10px;font-size: 11px;" class="detailsAnswer">{{dataSource.date}}</div>
                <div style="padding-left: 5px;" class="posting" [innerHTML]="dataSource.message"></div>     
            </div>
            <div class="separator"></div>
        </ng-template>
    </ejs-listview>
    <br>
    <button ejs-button cssClass="e-info" [isPrimary]="true" style="float: right;" (click)="openCommentDialog()">Add Comment</button>
</ejs-dialog>         
<!--
    Dialog for adding a new comment
-->    
<ejs-dialog id="addCommentDialog" #addCommentDialog [header]='addCommentHeader' [position]='position' [visible]='hidden' [isModal]='isModal'
[target]='target1' [width]='width1' [animationSettings]='animationSettings' [showCloseIcon]='showCloseIcon' (close)="commentDialogClose()">
    <form [formGroup]="commentForm" (ngSubmit)="onCommentSubmit()">
        <div class="form-group">
            <ejs-richtexteditor #fromRTE formControlName="comment" [toolbarSettings]='tools' 
                (created)="rteCreated()" [fileManagerSettings]='fileManagerSettings'>
            </ejs-richtexteditor>
            <ejs-uploader #defaultupload id='defaultfileupload' [asyncSettings]='path'  [allowedExtensions]='allowExtensions' (success)="onUploadSuccess($event)" 
            (selected)='onFileSelect($event)' (failure)="onUploadFailure($event)" [dropArea]='dropElement' (removing)='onFileRemove($event)'>
            </ejs-uploader>
            
                <!-- <span class="text-muted" *ngIf="!commentForm.controls['name'].valid && 
                commentForm.controls['name']?.touched"> Value is required.</span> -->

        </div>
        <br>
        <div class="form-group" style="float: right;">
            <button type="submit" ejs-button>Save</button>
            <button type="reset" ejs-button (click)="commentForm.reset()" style="margin-left: 20px">Reset</button>
        </div>
    </form>
</ejs-dialog>
<!--
    Dialog shows the evidence list
-->
<ejs-dialog class='e-fixed' id="evidenceDialog" #evidenceDialog [header]='evidenceHeader' [position]='position' [visible]='hidden' [isModal]='isModal'
[target]='target' [width]='evidenceDialogWidth' [animationSettings]='animationSettings' [showCloseIcon]='showCloseIcon'>
<!-- <ejs-dialog id="evidenceDialog" #evidenceDialog class='e-fixed' [header]='evidenceHeader' [position]='position' [visible]='hidden' [isModal]='isModal'
[target]='target' [width]='evidenceDialogWidth' [animationSettings]='animationSettings' [showCloseIcon]='showCloseIcon'>-->
    <div class="control-section"> 
        <ejs-grid #grid id='displayComments' style="height: 23rem;" [dataSource]='displayEvidences' [allowTextWrap]="true"
        class='cssClass' [toolbar]='evidenceToolbar' [editSettings]='evidenceEditSettings' (toolbarClick)='clickHandler($event)'>
        <!-- <ejs-grid #grid [dataSource]='displayEvidences' style="height: 23rem;" [allowTextWrap]="true" [allowSelection]='true' [allowSorting]='true' [height]="600" (toolbarClick)='clickHandler($event)'
        [pageSettings]='evidencePage' [gridLines]="lines" [toolbar]='evidenceToolbar' [editSettings]='evidenceEditSettings' [enableHover]='false' [enableHeaderFocus]='true'> -->
            <e-columns>
                <e-column width=20 textAlign="Center">
                    <ng-template #template let-evidence>
                        <!-- <ejs-tooltip #tooltip content='Delete Evidence'> -->
                            <button ejs-button class="e-btn e-small e-round" iconCss="e-icons e-delete" (click)="selectDeletedEvidence(evidence)"></button>
                        <!-- </ejs-tooltip> -->
                    </ng-template>
                </e-column>
                <e-column field='seq'  [filter]='filter' headerText='#' width=20 textAlign="Left" isPrimaryKey='true'></e-column>
                <e-column field='title'  [filter]='filter' headerText='Title' width=45 textAlign="Left" isPrimaryKey='true'></e-column>
                <e-column [filter]='filter' headerText='Evidence' width=45 textAlign="Left" isPrimaryKey='true'>
                    <ng-template #template let-data>
                        <div [innerHTML]="data.evidence"></div>
                    </ng-template>
                </e-column>
                <e-column field='date'  [filter]='filter' headerText='Date' width=60 textAlign="Left" isPrimaryKey='true'></e-column>
                <e-column field='comments'  [filter]='filter' headerText='Comments' width=80 textAlign="Left" isPrimaryKey='true'></e-column>
            </e-columns>
        </ejs-grid>
    </div>
</ejs-dialog>
<!--
    Confirmation Dialog for deleting existing evidence
-->
<ejs-dialog id='confirmDialog' #confirmDialog [visible]='hidden' [allowDragging]='true' [animationSettings]='animationSettings' [position]='position' content='Are you sure you want to delete this Evidence?' [target]='target'
header='Delete Evidence' width='450px' [buttons]='buttons' [showCloseIcon]='showCloseIcon'></ejs-dialog>  
<!--
    Add a new evidence
-->
<evidenceadd (childEvent)="addEvidence($event)" (childEvent2)= "getEvidence()"></evidenceadd>
<!--
    Toast Message
-->
<ejs-toast #toasttype id='toasttype' [position]="toastPosition" (created)="onCreate()" [target]="target"></ejs-toast>
<!--
    Confirmation Dialog Before Leaving the Release PAge without saving
-->
<ejs-dialog id='saveReleaseConfirmDialog' #saveReleaseConfirmDialog [visible]='hidden' [allowDragging]='true' [animationSettings]='animationSettings' [position]='position' content='This page contains some changes that are not been saved yet and will be lost if you navigate away. You can either discard them and navigate to the selected page or go back and review these changes.' [target]='target'
header='Leave Page?' width='450px' [buttons]='saveButtons' [showCloseIcon]='showCloseIcon'></ejs-dialog>  